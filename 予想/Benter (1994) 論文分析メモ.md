# Benter (1994) 論文分析メモ

## 論文情報
- **タイトル**: Computer Based Horse Race Handicapping and Wagering Systems: A Report
- **著者**: William Benter (HK Betting Syndicate, Hong Kong)
- **出典**: Efficiency of Racetrack Betting Markets

## 1. 論文の概要（Abstract）

Benter氏は、コンピュータを用いた競馬ハンディキャッピングと賭けシステムの実践的な要素を解説している。ロジットベースの手法と、ファンダメンタルモデルと大衆のオッズ推定を組み合わせるヒューリスティックな改善手法を提案。**5年間の実運用で有意な正の結果**を報告しており、パリミュチュエル方式の競馬における市場の非効率性の証拠として解釈できる。

## 2. 核心的アプローチ

### 2.1 ファンダメンタルハンディキャッピングモデル

**多項ロジットモデル（Multinomial Logit Model）** を使用して、各馬の勝利確率を推定する。モデルの出力は、レース内の全馬の確率推定値の合計が1になる。

### 2.2 特徴量（Factors）のカテゴリ

| カテゴリ | 具体的な要素 |
|---------|-------------|
| **現在のコンディション** | 最近のレース成績、前回レースからの経過時間、最近の調教データ、馬の年齢 |
| **過去のパフォーマンス** | 過去レースの着順、勝ち馬との差（馬身）、過去レースの正規化タイム |
| **過去成績の調整** | 過去レースの競争強度、斤量、騎手の貢献度、不運の補正、ポストポジションの有利不利 |
| **当日のレース条件** | 斤量、今日の騎手の能力、割り当てられたポストポジションの有利不利 |
| **嗜好性** | 距離適性、馬場適性（芝vsダート）、馬場状態適性（重vs良）、特定コース適性 |

### 2.3 モデル開発の要点

- **最小データ量**: 500〜1000レースが必要。1000レース以上でもout-of-sample精度は劇的には向上しない
- **閉じた母集団**: 同一管轄内の全レース結果を収集することで、各馬の完全な過去成績データが自動的に蓄積される
- **特徴量の洗練**: 単純な特徴量定義では不十分。継続的な試行錯誤と改善が必要

## 3. バイアスなき確率推定の作成（重要！）

### 3.1 大衆のオッズとモデル推定のバイアス

**Table 1**: 大衆のオッズが示す確率 vs 実際の勝率
- 低確率帯（.000-.010）: 予想確率.007 → 実際.007（一致）
- 高確率帯（>.400）: 予想確率.467 → 実際.484（一致）

**Table 2**: ファンダメンタルモデルの確率 vs 実際の勝率
- 低確率帯（.000-.010）: 予想確率.006 → 実際.005（-0.6σ）
- 高確率帯（>.400）: 予想確率.475 → 実際.432（-1.6σ）

### 3.2 重要な発見: ファンダメンタルモデルのバイアス

**Table 3 & 4** の分析から、ファンダメンタルモデルには一貫したバイアスがある：
- モデル推定確率が大衆推定より**高い**場合 → 実際の勝率はモデル推定に近い
- モデル推定確率が大衆推定より**低い**場合 → 実際の勝率は大衆推定に近い

**結論**: ファンダメンタルモデルは大衆のオッズから独立した推定とは言えない。バイアス補正が必要。

## 4. 確率推定の統合公式（核心！）

**2つの確率推定を統合するロジットモデル**:

```
c_i = exp(α・f_i + β・π_i) / Σexp(α・f_j + β・π_j)    (j = 1 to N)
```

- **f_i**: ファンダメンタルモデルのout-of-sample確率推定の対数
- **π_i**: 大衆のオッズが示す確率の対数
- **c_i**: 統合された確率推定
- **α, β**: 最尤法で推定されるパラメータ

**自然対数を使用する理由**: この変換により、より良いフィットが得られる

## 5. 競艇への適用可能性（初期考察）

| 競馬の要素 | 競艇での対応要素 |
|-----------|-----------------|
| 馬の能力 | 選手の能力（勝率、2連率など） |
| 騎手 | なし（選手が操縦者） |
| ポストポジション | 枠番（1〜6号艇） |
| 距離適性 | コース適性（競艇場ごとの特性） |
| 馬場状態 | 水面状態、天候、風向き |
| 斤量 | モーター性能 |

---
*続きは6-16ページで確認*


## 6. 統合モデルの検証結果（Table 5, 6, 7）

### Table 5: 統合モデル vs 実際の勝率
統合モデルは、大衆のオッズ単独やファンダメンタルモデル単独よりも「spread」が大きい（高確率・低確率の両端により多くの馬が分布）。これは統合モデルがより情報量が多いことを示す。

**重要**: 統合モデルの確率推定は、Table 3, 4で見られたバイアスがなく、ベッティングアドバンテージの正確な推定に適している。

### R²値の比較（モデルの説明力）
- **R²_P = .1218** (大衆のオッズのみ)
- **R²_F = .1245** (ファンダメンタルモデルのみ)
- **R²_C = .1396** (統合モデル)
- **ΔR²_C-P = .1396 - .1218 = .0178** ← ファンダメンタルモデルが追加する情報量

**重要な発見**: ΔR²値が大きいほど、実際のベッティングシミュレーションでの収益性が高い。

## 7. 賭け戦略（Wagering Strategy）

### 7.1 期待リターンの計算

```
expected return = er = c × div
advantage = er - 1
```

- **c**: 統合モデルによる勝利確率推定
- **div**: 配当（オッズ）
- **er > 1** の場合、正の期待値を持つ「アドバンテージベット」

### 7.2 Table 8: 期待リターンの例

| 馬番 | c (確率) | p (大衆確率) | er (期待リターン) | div (配当) |
|-----|---------|-------------|-----------------|-----------|
| 1 | .021 | .025 | .68 | 33 |
| 2 | .125 | .088 | 1.17 | 9.3 |
| 3 | .239 | .289 | .69 | 2.8 |
| 4 | .141 | .134 | .87 | 6.1 |
| 5 | .066 | .042 | 1.29 | 19 |
| 8 | .144 | .089 | 1.33 | 9.2 |
| 9 | .019 | .014 | 1.18 | 60 |

**er > 1** の馬（2, 5, 8, 9番）がアドバンテージベットの対象。

## 8. Kelly基準による賭け金の決定

### 8.1 基本Kelly公式

```
K = advantage / (dividend - 1)
```

- **K**: 総資金に対する賭け金の割合

### 8.2 Fractional Kelly戦略の推奨

**フルKellyは推奨されない理由**:
1. アドバンテージの過大評価はマイナス成長率を招く
2. 過去シミュレーションより実際のアドバンテージは小さい可能性
3. フルKellyは「ラフライド」（50%以上の資金減少が頻繁）
4. 定期的な出金が必要な実運用では不適切

**推奨**: 1/2 Kelly または 1/3 Kelly

### 8.3 プールサイズの制約

パリミュチュエル方式では、自分の賭けがオッズに影響する。
- **例**: プールサイズ$100,000、確率6%、配当20倍の場合
  - 最大期待利益ベット = $416
  - 期待利益 = $39.60
  - 2/3のベット($277)でも期待利益$35.5（最大の90%）

**実務的結論**: プールサイズが支配的な制約要因となる。

## 9. エキゾチックベット（連勝式）

### 9.1 連勝式の優位性

単勝で期待リターン < 1 の馬同士でも、組み合わせると正の期待値を持つ場合がある。

**例**:
- 馬1: c=.115, div=8.3, er=.955
- 馬2: c=.060, div=16.6, er=.996

Harville公式による1-2連勝確率: C_1,2,1 = .0151
大衆の連勝確率推定: P_1,2,1 = .0108
合理的配当: qdiv ≒ 76.85
**期待リターン: er = .0151 × 76.85 = 1.16 (16%のアドバンテージ)**

### 9.2 Harville公式（3連単確率）

```
π_ijk = (π_i × π_j × π_k) / ((1 - π_i)(1 - π_i - π_j))
```

**注意**: Harville公式にはバイアスがあり、補正が必要。

## 10. 競艇への適用における重要示唆

1. **統合モデルの構築**: ファンダメンタルモデル（選手・モーター・コース等）と大衆のオッズを統合
2. **ΔR²による評価**: モデルが大衆のオッズにどれだけ情報を追加できるかを測定
3. **Kelly基準の適用**: 1/2〜1/3 Kellyで動的な賭け金調整
4. **連勝式の活用**: 単勝より2連単・3連単でアドバンテージが大きくなる可能性
5. **プールサイズの考慮**: 競艇は競馬よりプールが小さいため、より重要な制約


## 11. Harville公式のバイアス補正

### Table 9 & 10: Harville公式のバイアス

Harville公式には有意なバイアスがある：
- **低確率馬**: 2着・3着になる頻度が予測より**高い**
- **高確率馬**: 2着・3着になる頻度が予測より**低い**

### 補正されたロジスティックモデル（式7-9）

**2着確率の補正**:
```
σ_i = exp(γ × log(π_i)) / Σexp(γ × log(π_j))
```

**3着確率の補正**:
```
τ_i = exp(δ × log(π_i)) / Σexp(δ × log(π_j))
```

**3連単確率**:
```
π_ijk = (π_i × σ_j × τ_k) / ((1 - σ_i)(1 - τ_i - τ_j))
```

**推定パラメータ**: γ = .81, δ = .65

Table 11, 12で、補正後のモデルはバイアスが大幅に減少していることを確認。

## 12. 実現可能性（Feasibility）

### 12.1 データの利用可能性

- 信頼性のある過去データが必要
- リアルタイムのコンピュータ入力が可能であること
- 最終オッズがレース開始前に利用可能であること

### 12.2 運用の容易さ

- 場外電話投票が理想的（オフィスから賭けられる）
- 最終オッズの正確な推定が重要
- 小規模プールでは締切直前のオッズ変動が大きく、モデルの有効性が低下

### 12.3 競争の存在

- 他のコンピュータハンディキャッパーの存在は不利
- 独立に開発されたモデルでも高い相関を持つ可能性
- 同じ馬に賭けることでオッズが下がり、全員の収益性が低下

### 12.4 プールサイズの制限

**最も深刻な制約**:
- 高い控除率（〜19%）により、極端な確率ミスプライシングのみが収益機会
- 最大期待利益は総プール売上の**0.25〜0.5%**程度
- 小規模プールでは運用が成り立たない可能性

## 13. 実績（Results）

### 5年間の運用結果（香港競馬）

- **約2000レース**のデータでモデル開発・テスト
- **約470レース/年**に賭け
- **平均控除率**: 約19%
- **プールサイズ**: > USD $10,000,000/レース（大規模プールのみ対象）

### 成果

- **4シーズン中4シーズンで純利益**
- 負けシーズンの損失は初期資本の約20%
- **強い上昇トレンド**が観察される（グラフ参照）
- エキゾチックプール（連勝式）のリターンが単勝・複勝より高い

### グラフ: 資産成長曲線

- X軸: 賭けたレース数（0〜2500）
- Y軸: log(資産/初期資産)
- **約2500レースで初期資産の約50倍（e^4 ≒ 55倍）に成長**

## 14. 結論（Conclusion）

> "Can a system beat the races?" can surely be answered in the affirmative.

- 統計的に導出されたファンダメンタルモデルで、有意な正の期待値を達成可能
- 特定のトラック、特定の時期に勝てるかは経験的な問題
- **「黄金時代」**: コンピュータ技術の進歩により、今がシステム構築の好機
- 将来的には、競争の激化により収益性が低下する可能性

## 15. 競艇への適用に向けた実装計画

### 15.1 Benter手法の競艇版フレームワーク

| Benter手法の要素 | 競艇での実装 |
|----------------|-------------|
| ファンダメンタルモデル | 選手能力、モーター、枠番、コース特性、天候を特徴量とした多項ロジットモデル |
| 大衆のオッズ | リアルタイムオッズ（10秒刻みで取得） |
| 統合モデル | 式(1)に基づく確率統合 |
| Kelly基準 | 1/3 Kellyで動的賭け金調整 |
| エキゾチックベット | 2連単・3連単への適用（Harville補正付き） |

### 15.2 必要なデータ

1. **過去データ**: 20年分のレース結果、選手成績、モーター成績
2. **リアルタイムデータ**: 締切直前のオッズ
3. **補足データ**: 天候、水面状況、選手コメント

### 15.3 検証ステップ

1. ファンダメンタルモデルの構築とR²の測定
2. 統合モデルのΔR²の測定
3. 過去データでのバックテスト（期待リターンの検証）
4. 仮想運用による検証
