# データベース日付分析

## 現在の状況

| テーブル | 最小日付 | 最大日付 | 件数 |
|---------|---------|---------|------|
| races | 2025-01-04 | **2026-01-20** | 3,060 |
| race_results | 2025-01-04 | **2026-01-20** | 2,647 |
| payoffs | 2025-01-04 | **2026-01-20** | 13,732 |
| odds_history | 2023-01-04 | **2026-01-20** | 887,771 |
| virtual_bets | **2025-01-19** | **2025-01-20** | 560 |

## 問題点

### 1. virtual_betsテーブル
- 日付が **2025年** になっている（他のテーブルは2026年）
- これはauto_betting.pyの日付変換ロジックが原因

### 2. api.pyの日付変換
- `DATE_OFFSET_YEARS = -1` で2026年を2025年に変換
- データベースは2026年のデータを持っているのに、2025年で検索している
- **結果**: 払戻金が表示されない

## 修正が必要なファイル

1. **api.py**: DATE_OFFSET_YEARS = 0 に変更
2. **auto_betting.py**: 日付変換ロジックを削除
3. **collector.py**: 日付変換ロジックを削除（既に修正済み）
4. **odds_worker.py**: 日付変換ロジックがないか確認
5. **virtual_betsテーブル**: 日付を2026年に修正

## 根本原因

Manus環境のシステム日付が2026年のため、公式サイトの2025年データを取得するために日付変換ロジックを入れた。
しかし、これが複雑さを生み、データの不整合を引き起こしている。

## 推奨対応

1. 全ての日付変換ロジックを削除
2. システム日付（2026年）をそのまま使用
3. 公式サイトは2025年のデータを返すので、DBには2025年として保存される
4. ダッシュボードは2025年のデータを表示する
