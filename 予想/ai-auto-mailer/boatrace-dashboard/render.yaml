# Render Blueprint - 競艇予想ダッシュボード
# kokotomo-db-stagingのみを使用するシンプル構成

services:
  # ダッシュボードWebサービス
  - type: web
    name: boatrace-dashboard
    runtime: python
    region: singapore
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn api:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kokotomo-db-staging
          property: connectionString
      - key: TZ
        value: Asia/Tokyo

  # 毎朝8:00に購入予定を登録
  - type: cron
    name: boatrace-daily-register
    runtime: python
    region: singapore
    buildCommand: pip install -r requirements.txt
    startCommand: python auto_betting.py register
    schedule: "0 23 * * *"  # 23:00 UTC = 08:00 JST
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kokotomo-db-staging
          property: connectionString
      - key: TZ
        value: Asia/Tokyo

  # 5分ごとに購入判断（締切1分前のレースを処理）
  - type: cron
    name: boatrace-decide-bets
    runtime: python
    region: singapore
    buildCommand: pip install -r requirements.txt
    startCommand: python auto_betting.py decide
    schedule: "*/5 23,0-13 * * *"  # 23:00-13:59 UTC = 08:00-22:59 JST
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kokotomo-db-staging
          property: connectionString
      - key: TZ
        value: Asia/Tokyo

  # 15分ごとに結果を更新
  - type: cron
    name: boatrace-update-results
    runtime: python
    region: singapore
    buildCommand: pip install -r requirements.txt
    startCommand: python auto_betting.py result
    schedule: "*/15 23,0-14 * * *"  # 23:00-14:59 UTC = 08:00-23:59 JST
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kokotomo-db-staging
          property: connectionString
      - key: TZ
        value: Asia/Tokyo

databases:
  - name: kokotomo-db-staging
    plan: basic-256mb
    region: singapore
