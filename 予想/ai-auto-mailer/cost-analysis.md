# AIメールシステム コスト分析

## 1. 使用している外部サービスと料金

| サービス | 用途 | 料金 |
|---------|------|------|
| **Render** | Webアプリケーションホスティング | 無料プラン（Free） |
| **PostgreSQL** | データベース | Render無料プラン or 外部サービス |
| **Google Gemini API** | メール分析・要約生成 | 従量課金（下記参照） |
| **Chatwork API** | 通知送信 | 無料（APIトークンのみ必要） |

## 2. Gemini API 料金詳細（gemini-2.0-flash使用）

現在システムで使用しているモデル: **Gemini 2.0 Flash**

| 項目 | 無料枠 | 有料枠（100万トークンあたり） |
|------|--------|------------------------------|
| **入力（テキスト/画像/動画）** | 無料 | $0.10 |
| **出力** | 無料 | $0.40 |
| **コンテキストキャッシュ** | 無料 | $0.025 |

## 3. メール1通あたりのコスト試算

### 前提条件
- メール本文: 平均500文字（日本語）≈ 約1,000トークン
- プロンプト: 約1,500トークン
- AI出力: 約300トークン（要約+返信案）

**合計トークン数（1通あたり）:**
- 入力: 約2,500トークン
- 出力: 約300トークン

**コスト（1通あたり）:**
- 入力: 2,500 ÷ 1,000,000 × $0.10 = **$0.00025**
- 出力: 300 ÷ 1,000,000 × $0.40 = **$0.00012**
- **合計: 約$0.00037（約0.055円 @150円/$）**

## 4. 月間コスト試算

### ケース1: ライトユーザー（1日10通）
- 月間メール数: 10通 × 30日 = **300通**
- 月間コスト: 300 × $0.00037 = **$0.11（約17円）**

### ケース2: ミドルユーザー（1日50通）
- 月間メール数: 50通 × 30日 = **1,500通**
- 月間コスト: 1,500 × $0.00037 = **$0.56（約84円）**

### ケース3: ヘビーユーザー（1日200通）
- 月間メール数: 200通 × 30日 = **6,000通**
- 月間コスト: 6,000 × $0.00037 = **$2.22（約333円）**

### ケース4: 超ヘビーユーザー（1日500通）
- 月間メール数: 500通 × 30日 = **15,000通**
- 月間コスト: 15,000 × $0.00037 = **$5.55（約833円）**

## 5. その他のコスト

| 項目 | 料金 |
|------|------|
| **Render（無料プラン）** | $0 |
| **PostgreSQL（Render無料）** | $0 |
| **Chatwork API** | $0（既存アカウント使用） |

## 6. まとめ

**ヘビーユーザー（1日200通）の場合:**
- **月間コスト: 約333円**
- 内訳: Gemini API のみ

**超ヘビーユーザー（1日500通）の場合:**
- **月間コスト: 約833円**

### 注意点
1. **無料枠の活用**: Gemini APIには無料枠があるため、小規模利用なら完全無料で運用可能
2. **Renderの制限**: 無料プランは月750時間の制限あり（常時稼働なら問題なし）
3. **データベース容量**: 無料プランは1GBまで。大量のメール履歴を保存する場合は有料プラン検討

### コスト削減案
1. **古いメールの削除**: 一定期間経過後に要約データを削除
2. **スパムメールの事前フィルタ**: IMAPレベルでスパムを除外し、AI分析を減らす
3. **バッチ処理の最適化**: 重複チェックを強化し、同じメールを複数回分析しない
